<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Little Score - ç§»åŠ¨ç«¯é¢„è§ˆ</title>
    
    <!-- å¼•å…¥æ ·å¼åº“ -->
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* å…¨å±€é‡ç½® */
        body { 
            background-color: #e5e7eb; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            min-height: 100vh; 
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif;
        }

        /* æ ¸å¿ƒæ‰‹æœºå®¹å™¨ - è¿™é‡Œçš„ flex å¸ƒå±€æ˜¯å…³é”® */
        #app-container { 
            width: 100%; 
            max-width: 420px; /* é™åˆ¶æœ€å¤§å®½åº¦æ¨¡æ‹Ÿæ‰‹æœº */
            height: 100vh;    /* å æ»¡é«˜åº¦ */
            max-height: 900px; /* æ¡Œé¢ç«¯é¢„è§ˆæ—¶ä¸è‡³äºå¤ªé•¿ */
            background: #F9FAFB; 
            position: relative; 
            box-shadow: 0 0 25px rgba(0,0,0,0.1); 
            display: flex;      /* å¼€å¯ Flex */
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            overflow: hidden;   /* é˜²æ­¢æº¢å‡º */
        }

        /* æ¡Œé¢ç«¯ç‰¹æœ‰çš„åœ†è§’å’Œè¾¹æ¡† (ä»…ä¸ºäº†å¥½çœ‹) */
        @media (min-width: 450px) {
            #app-container {
                height: 90vh;
                border-radius: 20px;
                border: 8px solid #fff;
            }
        }

        /* å†…å®¹åŒºåŸŸ - å æ®å‰©ä½™ç©ºé—´å¹¶å†…éƒ¨æ»šåŠ¨ */
        .page-content { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch; /* iOS é¡ºæ»‘æ»šåŠ¨ */
            padding-bottom: 20px; 
            position: relative;
        }
        
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .page-content::-webkit-scrollbar { width: 0px; background: transparent; }

        /* åŠ¨ç”»ç±» */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        .wave { animation: wave 1s infinite ease-in-out; }
        @keyframes wave { 
            0%, 100% { height: 10px; } 
            50% { height: 25px; } 
        }
        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app" v-cloak style="width: 100%; display: flex; justify-content: center;">
    <div id="app-container">
        
        <!-- 1. å¯æ»šåŠ¨çš„å†…å®¹åŒºåŸŸ -->
        <div class="page-content">
            
            <!-- é¦–é¡µ Home -->
            <transition name="fade">
                <div v-if="activeTab === 0" class="p-4 space-y-4">
                    <!-- é¡¶éƒ¨æ  -->
                    <div class="flex justify-between items-center pt-2">
                        <div class="flex items-center space-x-2" @click="showStudentSheet = true">
                            <img class="w-10 h-10 rounded-full border-2 border-white shadow-sm" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="">
                            <div>
                                <div class="font-bold text-gray-800 flex items-center">å¼ å°æ˜ <van-icon name="arrow-down" class="ml-1 text-xs"></van-icon></div>
                                <div class="text-xs text-gray-500">å››å¹´çº§ / Lv.5</div>
                            </div>
                        </div>
                        <van-icon name="bell" size="24" class="text-gray-600" dot></van-icon>
                    </div>

                    <!-- ç§¯åˆ†å¤§å¡ç‰‡ -->
                    <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                        <div class="relative z-10">
                            <div class="text-sm opacity-90 mb-1">å½“å‰å¯ç”¨ç§¯åˆ†</div>
                            <div class="text-5xl font-bold font-mono tracking-tighter mb-3">{{ points }}</div>
                            <div class="flex justify-between items-end">
                                <div class="text-xs bg-white/20 px-2 py-1 rounded-lg backdrop-blur-sm">ç´¯è®¡å…‘æ¢: 500</div>
                                <div class="bg-white text-orange-500 px-3 py-1 rounded-full text-xs font-bold shadow-sm active:opacity-80" @click="activeTab = 2">å»å…‘æ¢ ></div>
                            </div>
                        </div>
                        <van-icon name="gold-coin" class="absolute -bottom-6 -right-6 text-white opacity-20 rotate-12" size="140"></van-icon>
                    </div>

                    <!-- å¿«æ·æŒ‰é’® -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white p-4 rounded-xl shadow-sm flex items-center space-x-3 active:bg-gray-50 transition" @click="activeTab = 1">
                            <div class="bg-blue-100 p-2 rounded-full text-blue-500"><van-icon name="edit"></van-icon></div>
                            <span class="font-bold text-gray-700">è®°ä¸€ç¬”</span>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-sm flex items-center space-x-3 active:bg-gray-50 transition" @click="activeTab = 2">
                            <div class="bg-pink-100 p-2 rounded-full text-pink-500"><van-icon name="gift"></van-icon></div>
                            <span class="font-bold text-gray-700">æ¢å¥–åŠ±</span>
                        </div>
                    </div>

                    <!-- åŠ¨æ€ -->
                    <div class="bg-white rounded-xl shadow-sm p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-800">ä»Šæ—¥åŠ¨æ€</h3>
                            <span class="text-xs text-gray-400">æŸ¥çœ‹æ›´å¤š</span>
                        </div>
                        <van-steps direction="vertical" :active="0" active-color="#4A90E2">
                            <van-step>
                                <div class="flex justify-between">
                                    <span class="font-medium">æ•°å­¦ä½œä¸š (A*)</span>
                                    <span class="text-yellow-500 font-bold">+15</span>
                                </div>
                                <p class="text-xs text-gray-400">10:30 AM</p>
                            </van-step>
                            <van-step>
                                <div class="flex justify-between">
                                    <span class="font-medium">å…‘æ¢ çœ‹ç”µè§†30åˆ†é’Ÿ</span>
                                    <span class="text-red-400 font-bold">-50</span>
                                </div>
                                <p class="text-xs text-gray-400">09:15 AM</p>
                            </van-step>
                        </van-steps>
                    </div>
                </div>
            </transition>

            <!-- ä»»åŠ¡ Tasks -->
            <transition name="fade">
                <div v-if="activeTab === 1">
                    <van-sticky :offset-top="0" :container="containerRef">
                        <div class="bg-white shadow-sm pb-1 pt-1">
                            <van-search v-model="searchValue" placeholder="æœç´¢ä»»åŠ¡..." shape="round"></van-search>
                            <van-tabs v-model:active="taskFilter" shrink>
                                <van-tab title="å…¨éƒ¨" name="all"></van-tab>
                                <van-tab title="å­¦ä¹ " name="study"></van-tab>
                                <van-tab title="ç”Ÿæ´»" name="life"></van-tab>
                            </van-tabs>
                        </div>
                    </van-sticky>
                    
                    <div class="p-3 space-y-3">
                        <div v-for="task in tasks" :key="task.id" class="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between border border-transparent active:border-blue-200 transition">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl" :class="task.bg">
                                    {{ task.emoji }}
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">{{ task.title }}</div>
                                    <div class="text-xs text-gray-400 mt-1">
                                        <span class="bg-gray-100 px-1 rounded text-gray-500 mr-1">{{ task.tag }}</span>
                                        é¢„è®¡ +{{ task.points }}
                                    </div>
                                </div>
                            </div>
                            <van-button 
                                round 
                                size="small" 
                                :type="task.done ? 'success' : 'default'" 
                                :icon="task.done ? 'success' : ''"
                                @click="handleTaskClick(task)"
                            >
                                {{ task.done ? 'å·²é¢†' : 'å®Œæˆ' }}
                            </van-button>
                        </div>
                        <!-- å ä½ç¬¦ç¡®ä¿èƒ½æ»šåŠ¨åˆ°åº• -->
                        <div class="h-10"></div>
                    </div>
                </div>
            </transition>

            <!-- å•†åŸ Mall -->
            <transition name="fade">
                <div v-if="activeTab === 2" class="p-3">
                    <div class="flex justify-center mb-4 mt-2">
                        <div class="bg-white p-1 rounded-full flex shadow-sm border border-gray-100">
                            <div class="px-6 py-1.5 rounded-full bg-yellow-400 text-white font-bold text-sm">å…‘æ¢å¥–åŠ±</div>
                            <div class="px-6 py-1.5 rounded-full text-gray-500 text-sm">å…‘æ¢è®°å½•</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="item in rewards" :key="item.id" class="bg-white rounded-xl overflow-hidden shadow-sm flex flex-col">
                            <div class="h-24 bg-gray-50 flex items-center justify-center text-5xl">{{ item.emoji }}</div>
                            <div class="p-3 flex-1 flex flex-col justify-between">
                                <div class="font-bold text-gray-800 text-sm line-clamp-1">{{ item.title }}</div>
                                <div class="flex justify-between items-center mt-3">
                                    <span class="text-yellow-500 font-bold font-mono text-lg">{{ item.cost }}</span>
                                    <van-button size="mini" round color="#FFD700" text-color="#000" @click="redeem(item)">å…‘æ¢</van-button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-10"></div>
                </div>
            </transition>

            <!-- æˆ‘çš„ Mine -->
            <transition name="fade">
                <div v-if="activeTab === 3" class="p-4">
                     <div class="bg-white rounded-xl p-4 shadow-sm mb-4 flex items-center space-x-3">
                        <img class="w-16 h-16 rounded-full" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="">
                        <div>
                            <div class="text-xl font-bold">å¼ å°æ˜</div>
                            <div class="text-gray-500 text-sm">è´¦å·ç®¡ç† ></div>
                        </div>
                     </div>
                     <van-cell-group inset>
                         <van-cell title="å­¦ç”Ÿç®¡ç†" icon="friends-o" is-link></van-cell>
                         <van-cell title="é¡¹ç›®è®¾ç½®" icon="setting-o" is-link></van-cell>
                         <van-cell title="å…³äºæˆ‘ä»¬" icon="info-o" is-link value="v1.0"></van-cell>
                     </van-cell-group>
                </div>
            </transition>
        </div>

        <!-- 
            2. åº•éƒ¨å¯¼èˆª - å…³é”®ä¿®æ”¹ 
            :fixed="false" 
            è®©å®ƒä¸å†ç›¸å¯¹äºæµè§ˆå™¨å®šä½ï¼Œè€Œæ˜¯è‡ªç„¶æ’åˆ—åœ¨ Flex å®¹å™¨åº•éƒ¨
        -->
        <van-tabbar v-model="activeTab" active-color="#4A90E2" :fixed="false" class="border-t border-gray-100">
            <van-tabbar-item icon="home-o">é¦–é¡µ</van-tabbar-item>
            <van-tabbar-item icon="todo-list-o">ä»»åŠ¡</van-tabbar-item>
            <van-tabbar-item icon="gift-o">å•†åŸ</van-tabbar-item>
            <van-tabbar-item icon="manager-o">æˆ‘çš„</van-tabbar-item>
        </van-tabbar>

        <!-- 3. AI æ‚¬æµ®çƒ - æ”¹ä¸º absolute -->
        <div 
            class="absolute bottom-20 right-5 z-40 w-14 h-14 bg-gradient-to-tr from-blue-500 to-cyan-400 rounded-full shadow-xl flex items-center justify-center cursor-pointer hover:scale-105 active:scale-90 transition-transform"
            @click="openAI"
        >
            <van-icon name="music-o" size="26" color="white"></van-icon>
        </div>

        <!-- AI äº¤äº’é®ç½© - ç¡®ä¿åœ¨å®¹å™¨å†…å…¨å± -->
        <div v-if="showAI" class="absolute inset-0 bg-black/60 z-50 flex items-end" @click="showAI = false">
            <div class="w-full" @click.stop>
                 <!-- çŠ¶æ€å¡ç‰‡ -->
                 <transition name="van-slide-up" appear>
                    <div class="bg-white w-full rounded-t-2xl p-6 shadow-2xl relative overflow-hidden">
                        
                        <!-- å…³é—­æŒ‰é’® -->
                        <div class="absolute top-4 right-4 text-gray-400" @click="showAI = false">
                            <van-icon name="cross"></van-icon>
                        </div>

                        <!-- é˜¶æ®µ 1: è†å¬ä¸­ -->
                        <div v-if="aiState === 'listening'" class="text-center py-4">
                            <div class="text-lg font-bold text-gray-800 mb-2">æ­£åœ¨å¬...</div>
                            <div class="flex justify-center items-end h-10 space-x-1.5 mb-6">
                                <div class="w-1.5 bg-blue-500 rounded-full wave" style="animation-delay: 0s"></div>
                                <div class="w-1.5 bg-blue-400 rounded-full wave" style="animation-delay: 0.1s"></div>
                                <div class="w-1.5 bg-blue-600 rounded-full wave" style="animation-delay: 0.2s"></div>
                                <div class="w-1.5 bg-blue-300 rounded-full wave" style="animation-delay: 0.3s"></div>
                            </div>
                            <div class="text-sm text-gray-400 mb-6">"è¯­æ–‡ä½œä¸šå¾—äº†Aï¼Œå¥–åŠ±10åˆ†"</div>
                            <div class="flex gap-3">
                                <van-button block round plain size="small" @click="aiState='typing'">é”®ç›˜è¾“å…¥</van-button>
                                <van-button block round type="danger" size="small" @click="finishListening">è¯´å®Œäº†</van-button>
                            </div>
                        </div>

                        <!-- é˜¶æ®µ 2: è§£æç¡®è®¤ -->
                        <div v-else-if="aiState === 'confirm'" class="text-left">
                            <div class="flex items-center text-green-600 mb-3 bg-green-50 p-2 rounded-lg">
                                <van-icon name="smile-o" class="mr-2"></van-icon>
                                <span class="font-bold text-sm">è¯†åˆ«æˆåŠŸï¼Œè¯·ç¡®è®¤ï¼š</span>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-xl space-y-3 mb-4 border border-gray-100">
                                <div class="flex justify-between">
                                    <span class="text-gray-500 text-sm">æ“ä½œç±»å‹</span>
                                    <van-tag type="primary">æ–°å¢ä»»åŠ¡</van-tag>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500 text-sm">é¡¹ç›®</span>
                                    <span class="font-bold text-gray-800">è¯­æ–‡ä½œä¸š</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500 text-sm">è¯„åˆ†</span>
                                    <span class="font-bold text-orange-500">A</span>
                                </div>
                                <div class="flex justify-between items-center border-t border-gray-200 pt-2 mt-2">
                                    <span class="text-gray-500 text-sm">ç§¯åˆ†å˜åŠ¨</span>
                                    <span class="text-xl font-bold text-yellow-500">+10</span>
                                </div>
                            </div>

                            <van-button block round type="primary" class="mb-2" @click="executeAI">âœ… ç¡®è®¤æ‰§è¡Œ</van-button>
                            <van-button block round plain type="default" size="small" @click="aiState='listening'">é‡è¯•</van-button>
                        </div>
                        
                        <!-- é˜¶æ®µ 3: æ‰‹åŠ¨è¾“å…¥ -->
                        <div v-else-if="aiState === 'typing'">
                            <div class="font-bold mb-3">è¾“å…¥æŒ‡ä»¤</div>
                            <van-field v-model="inputText" rows="2" autosize type="textarea" class="bg-gray-100 rounded-lg mb-4" placeholder="ä¾‹ï¼šæ‹–åœ°å¥–åŠ± 20 ç§¯åˆ†"></van-field>
                            <van-button block round type="primary" @click="finishListening" :loading="loading">å‘é€</van-button>
                        </div>

                    </div>
                </transition>
            </div>
        </div>

        <!-- é€šç”¨å¼¹çª—ç»„ä»¶ -->
        <van-action-sheet v-model:show="showStudentSheet" :actions="[{ name: 'å¼ å°æ˜ (å½“å‰)' }, { name: 'æå°çº¢' }, { name: '+ æ·»åŠ å­¦ç”Ÿ' }]" cancel-text="å–æ¶ˆ"></van-action-sheet>

        <van-dialog v-model:show="showScoreDialog" title="ä»»åŠ¡å®Œæˆï¼" show-cancel-button confirm-button-text="ç¡®è®¤åŠ åˆ†" confirm-button-color="#FFD700" @confirm="addPoints">
            <div class="p-6 text-center">
                <div class="text-4xl mb-2">ğŸ‰</div>
                <div class="text-gray-500 mb-4">å¤ªæ£’äº†ï¼Œç»™æœ¬æ¬¡è¡¨ç°æ‰“ä¸ªåˆ†å§</div>
                <van-rate v-model="rateVal" :count="5" icon="star" void-icon="star-o" size="30" color="#FFD700" class="mb-2"></van-rate>
                <div class="text-sm text-yellow-500 font-bold mt-2">+10 ç§¯åˆ†</div>
            </div>
        </van-dialog>

    </div>
</div>

<!-- å¼•å…¥ Vue å’Œ Vant JS -->
<script src="https://fastly.jsdelivr.net/npm/vue@3"></script>
<script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>

<script>
    const { createApp, ref } = Vue;
    const { showToast, showSuccessToast } = vant;

    const app = createApp({
        setup() {
            // çŠ¶æ€ç®¡ç†
            const activeTab = ref(0);
            const points = ref(1250);
            const searchValue = ref('');
            const taskFilter = ref('all');
            const showStudentSheet = ref(false);
            const containerRef = ref(null); // ç”¨äº sticky
            
            // AI ç›¸å…³çŠ¶æ€
            const showAI = ref(false);
            const aiState = ref('listening'); 
            const inputText = ref('');
            const loading = ref(false);

            // ä»»åŠ¡å®Œæˆå¼¹çª—
            const showScoreDialog = ref(false);
            const rateVal = ref(4);

            // æ•°æ® Mock
            const tasks = ref([
                { id: 1, title: 'èƒŒè¯µè‹±è¯­å•è¯ Unit 1', tag: 'å­¦ä¹ ', points: 10, bg: 'bg-blue-100 text-blue-500', emoji: 'ğŸ“˜', done: false },
                { id: 2, title: 'æ•´ç†è‡ªå·±çš„æˆ¿é—´', tag: 'å®¶åŠ¡', points: 20, bg: 'bg-green-100 text-green-500', emoji: 'ğŸ§¹', done: false },
                { id: 3, title: 'ç»ƒä¹ é’¢ç´ 30åˆ†é’Ÿ', tag: 'å…´è¶£', points: 15, bg: 'bg-purple-100 text-purple-500', emoji: 'ğŸ¹', done: true },
            ]);

            const rewards = ref([
                { id: 1, title: 'çœ‹ç”µè§† 30åˆ†é’Ÿ', cost: 50, emoji: 'ğŸ“º' },
                { id: 2, title: 'è´­ä¹° 10å…ƒ é›¶é£Ÿ', cost: 100, emoji: 'ğŸ¦' },
                { id: 3, title: 'å…åšä¸€æ¬¡å®¶åŠ¡', cost: 200, emoji: 'ğŸŸï¸' },
                { id: 4, title: 'æ¸¸ä¹å›­é—¨ç¥¨', cost: 1000, emoji: 'ğŸ¡' },
            ]);

            // æ–¹æ³•
            const openAI = () => {
                showAI.value = true;
                aiState.value = 'listening';
                setTimeout(() => {
                    if(showAI.value && aiState.value === 'listening') {
                        finishListening();
                    }
                }, 3500);
            };

            const finishListening = () => {
                loading.value = true;
                setTimeout(() => {
                    loading.value = false;
                    aiState.value = 'confirm';
                }, 800);
            };

            const executeAI = () => {
                showAI.value = false;
                showSuccessToast('æ‰§è¡ŒæˆåŠŸï¼šç§¯åˆ† +10');
                points.value += 10;
                tasks.value.unshift({ 
                    id: Date.now(), title: 'è¯­æ–‡ä½œä¸š', tag: 'AIæ·»åŠ ', points: 10, bg: 'bg-yellow-100 text-yellow-600', emoji: 'ğŸ¤–', done: true 
                });
            };

            const handleTaskClick = (task) => {
                if (task.done) return;
                showScoreDialog.value = true;
            };

            const addPoints = () => {
                points.value += 10;
                showSuccessToast('ç§¯åˆ† +10');
                tasks.value[0].done = true; 
            };

            const redeem = (item) => {
                if (points.value < item.cost) {
                    showToast('ç§¯åˆ†ä¸è¶³å“¦ï¼');
                    return;
                }
                vant.showConfirmDialog({
                    title: 'ç¡®è®¤å…‘æ¢',
                    message: `ç¡®å®šæ¶ˆè€— ${item.cost} ç§¯åˆ†å…‘æ¢ "${item.title}" å—ï¼Ÿ`,
                }).then(() => {
                    points.value -= item.cost;
                    showSuccessToast('å…‘æ¢æˆåŠŸ');
                });
            };

            return {
                activeTab, points, searchValue, taskFilter, showStudentSheet, containerRef,
                tasks, rewards,
                showAI, aiState, inputText, loading, openAI, finishListening, executeAI,
                handleTaskClick, showScoreDialog, rateVal, addPoints, redeem
            };
        }
    });

    app.use(vant);
    app.mount('#app');
</script>
</body>
</html>